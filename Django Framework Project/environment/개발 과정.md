###9월 27일
#RDS 및 데이터베이스 설정
문서작업이 마무리가 되어가는 것 보고 실제 개발을 시작하였다.
앞에 개발했던 데이터베이스를 실제로 구현하기 위해서
RDS 접속 설정 시도을 먼저 시도 하였다.

호스트 이름 : jws.cc5v8olvshdu.us-east-2.rds.amazonaws.com
포트 : 1521
SSID : LINKPLUS -> bumarket
사용자 이름 : jws -> bumarket
비밀번호 : ********
ALTER SESSION SET CURRENT_SCHEMA = BUMARKET;

create user 계정명 identified by 비밀번호; 이렇게 명령어를 입력하여 새로운 계정을 생성줍니다.

grant connect, resource, dba to 계정명
위와 같이 입력해주시면 자신이 만든 계정에 접근권한을 줄 수 있습니다.
이렇게 만든 계정을 가지고 새접속을 한번 시도하였다.

create user bumarket identified by ********;
grant connect, resource, dba to bumarket
ALTER SESSION SET CURRENT_SCHEMA = BUMARKET;
commit

EC2는 기존의 EC2를 재사용하기로 하였다. 코드의 재사용 만큼이나 서버의 재사용도 중요하다.
호스트 이름 : jws.cc5v8olvshdu.us-east-2.rds.amazonaws.com
포트 : 1521
SSID : LINKPLUS
사용자 이름 : bumarket
비밀번호 : ********

__init__.py 는 빈 파일입니다. 이 파일은 Python에게 이 디렉토리를 하나의 Python 패키지로 다루도록 지시합니다.
settings.py 는 웹사이트의 모든 설정을 포함하고 있습니다. 이 곳에는 우리가 만드는 어떤 application이라도 등록이 되는 곳이며,  static files의 위치, database 세부 설정 등이 들어갑니다.
urls.py 는 사이트의 url - view의 연결을 지정해줍니다. 여기에는 모든 url 매핑 코드가 포함될 수 있지만, 특정한 어플리케이션에 매핑의 일부를 할당해주는 것이 일반적입니다.
wsgi.py 는 당신의 장고 어플리케이션이 웹서버와 연결 및 소통하는 것을 돕습니다. 당신은 이것을 표준 형식(boilerplate)으로 다뤄도 무방합니다.

settings.py에 나의 AWS RDS 데이터베이스의 접속을 설정하였다. 대부분의 개발환경세팅을 settings.py 에서 끝낼수가 있다.
# Database
# https://docs.djangoproject.com/en/1.10/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.oracle',
        'NAME': 'near_company',  # 데이터베이스 이름
        'USER': 'dev',    # 오라클 사용자 계정
        'PASSWORD': 'dev123!@#',  # 오라클 패스워드
        'HOST': '', 
        'PORT': ""
    }
}

###9월 28일 

#테이블 생성
CREATE TABLE "UserTB" (
	"UserId"	varchar2(20)		NOT NULL,
	"Password"	varchar2(20)		NOT NULL,
	"UserName"	varchar2(20)		NOT NULL,
	"Phone"	varchar2(20)		NOT NULL,
	"KakaoId"	varchar2(20)		NOT NULL,
	"Email"	varchar2(50)		NOT NULL
);

CREATE TABLE "UserImageTB" (
	"UserId"	varchar2(20)		NULL,
	"ImageId"	number(20)		NULL
);

CREATE TABLE "ProImageTB" (
	"ProductId"	number(20)		NULL,
	"ImageId"	number(20)		NULL
);

CREATE TABLE "ProductTB" (
	"ProductId"	number(20)		NOT NULL,
	"ProductName"	varchar2(50)		NOT NULL,
	"ProductCategory"	number(20)		NOT NULL,
	"ProductPrice"	number(20)		NOT NULL,
	"ProductText"	varchar2(3000)		NULL,
	"ProductDate"	date		NOT NULL,
	"ProductType"	number(20)		NOT NULL,
	"UserId"	varchar2(20)		NULL
);

CREATE TABLE "SaleTB" (
	"SaleId"	number(20)		NOT NULL,
	"SaleDate"	date		NOT NULL,
	"ProductId"	number(20)		NULL
);

CREATE TABLE "LikeTB" (
	"Like"	number(20)		NOT NULL,
	"UserId"	varchar2(20)		NULL,
	"ProductId"	number(20)		NULL
);

CREATE TABLE "ImageTB" (
	"ImageId"	number(20)		NOT NULL,
	"ImageName"	varchar2(1000)		NULL,
	"ImageSize"	varchar2(1000)		NULL,
	"ImageLink"	varchar2(1000)		NULL
);

ALTER TABLE "UserTB" ADD CONSTRAINT "PK_USERTB" PRIMARY KEY (
	"UserId"
);

ALTER TABLE "ProductTB" ADD CONSTRAINT "PK_PRODUCTTB" PRIMARY KEY (
	"ProductId"
);

ALTER TABLE "SaleTB" ADD CONSTRAINT "PK_SALETB" PRIMARY KEY (
	"SaleId"
);

ALTER TABLE "LikeTB" ADD CONSTRAINT "PK_LIKETB" PRIMARY KEY (
	"Like"
);

ALTER TABLE "ImageTB" ADD CONSTRAINT "PK_IMAGETB" PRIMARY KEY (
	"ImageId"
);

ALTER TABLE "UserImageTB" ADD CONSTRAINT "FK_UserTB_TO_UserImageTB_1" FOREIGN KEY (
	"UserId"
)
REFERENCES "UserTB" (
	"UserId"
);

ALTER TABLE "UserImageTB" ADD CONSTRAINT "FK_ImageTB_TO_UserImageTB_1" FOREIGN KEY (
	"ImageId"
)
REFERENCES "ImageTB" (
	"ImageId"
);

ALTER TABLE "ProImageTB" ADD CONSTRAINT "FK_ProductTB_TO_ProImageTB_1" FOREIGN KEY (
	"ProductId"
)
REFERENCES "ProductTB" (
	"ProductId"
);

ALTER TABLE "ProImageTB" ADD CONSTRAINT "FK_ImageTB_TO_ProImageTB_1" FOREIGN KEY (
	"ImageId"
)
REFERENCES "ImageTB" (
	"ImageId"
);

ALTER TABLE "ProductTB" ADD CONSTRAINT "FK_UserTB_TO_ProductTB_1" FOREIGN KEY (
	"UserId"
)
REFERENCES "UserTB" (
	"UserId"
);

ALTER TABLE "SaleTB" ADD CONSTRAINT "FK_ProductTB_TO_SaleTB_1" FOREIGN KEY (
	"ProductId"
)
REFERENCES "ProductTB" (
	"ProductId"
);

ALTER TABLE "LikeTB" ADD CONSTRAINT "FK_UserTB_TO_LikeTB_1" FOREIGN KEY (
	"UserId"
)
REFERENCES "UserTB" (
	"UserId"
);

ALTER TABLE "LikeTB" ADD CONSTRAINT "FK_ProductTB_TO_LikeTB_1" FOREIGN KEY (
	"ProductId"
)
REFERENCES "ProductTB" (
	"ProductId"
);


COMMIT

#인코딩
https://itmining.tistory.com/115
#-*- coding: utf-8 -*- 
 한글을 사용하면 위에 꼭 써야함

###10월 2일
#파이썬 가상환경 세팅

bash sell을 사용할 경우 ~/.bash_profile 경로를
zsh을 사용할 경우 ~/.zshrc 경로 사용
$ echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bash_profile
$ echo 'export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bash_profile
$ echo 'eval "$(pyenv init -)"' >> ~/.bash_profile
#입력한 환경변수 적용
$ source ~/.bash_profile 

https://ithub.tistory.com/210

###10월 4일

#포스트맨 설치
https://www.getpostman.com/downloads/

#가상환경 세팅
sudo pip3 install virtualenv
sudo pip3 install virtualenvwrapper
디폴트 디렉토리 만들기 (.virtualenv)
mkdir ~/.virtualenvs
WORKON_HOME 환경 변수에 디폴트 디렉토리 등록
export WORKON_HOME=~/.virtualenvs
.profile(우분투 기준 유저 로그인시 실행되는 스크립트) 에 virtualenvwrapper를 임포트 하도록 위 파일의 가장 하단에 아래 스크립트 추가
. /usr/local/bin/virtualenvwrapper.sh
source /usr/local/bin/virtualenvwrapper.sh

mkvirtualenv {{가상환경-이름}}
mkvirtualenv testserver
(testserver 가상환경) which python
명령어를 실행했을 때 아래와 같은 경로로 나오면 제대로 된것이다.
/home/user_name/.virtualenvs/testserver/bin/python

#가상환경을 나갈 때
(testserver 가상환경) deactivate

#가상환경 진입
workon testserver

#가상환경에서 장고 설치
(testserver 가상환경) pip3 install django
(testserver 가상환경) pip3 install djangorestframework
(testserver 가상환경) pip3 install cx_oracle
(testserver 가상환경) pip3 install django_filter
(testserver 가상환경) pip3 install django-rest-swagger
(testserver 가상환경) pip3 install rest_framework_swagger
(testserver 가상환경) cd ~/BuMarket
(testserver 가상환경) python3 manage.py startapp testserver0
(testserver 가상환경) cd testserver0

#가상환경에서 서버 실행
mkvirtualenv testserver
(testserver 가상환경) python3 apps.py migrate
(testserver 가상환경) python3 apps.py runserver

(testserver 가상환경) python3 manage.py createsuperuser
(testserver 가상환경) python3 manage.py runserver


http://rpi_IP_address:8000/ 주소로 접속해서 확인

#데이터 베이스에 테스트용 더미 데이터 강제 주입
오라클에서 현재 세션의 접속 스키마를 변경하는 방법은 ALTER SESSION를 이용하면 됩니다.
ALTER SESSION SET CURRENT_SCHEMA = 스키마명;

더미 데이터 입력
INSERT INTO "UserTB" VALUES (1002, 00000000, 0000, '01035797065', 1002, 0000);

SELECT * FROM "UserTB";

INSERT INTO "ProductTB" VALUES (0001, 1111, 1, 1111, 1111, SYSDATE, 1, 1002);

SELECT * FROM "ProductTB";

(testserver 가상환경) python3 manage.py migrate
(testserver 가상환경) python3 manage.py createsuperuser
(testserver 가상환경) python3 manage.py runserver

#오라클 데이터베이스 인스턴스 클라이언트 설치

https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html

wget https://download.oracle.com/otn_software/linux/instantclient/193000/oracle-instantclient19.3-basic-19.3.0.0.0-1.x86_64.rpm
wget https://download.oracle.com/otn_software/linux/instantclient/193000/oracle-instantclient19.3-sqlplus-19.3.0.0.0-1.x86_64.rpm
wget https://download.oracle.com/otn_software/linux/instantclient/193000/oracle-instantclient19.3-devel-19.3.0.0.0-1.x86_64.rpm

root 권한 : sudo apt-get install alien dpkg-dev debhelper build-essential
root 권한 : sudo alien -c oracle basic
root 권한 : sudo alien -c oracle sql
root 권한 : sudo alien -c oracle dev
root 권한 : sudo dpkg -i oracle basic
root 권한 : sudo dpkg -i oracle sql
root 권한 : sudo dpkg -i oracle dev

#외부접속 가능 서버 구동
(testserver 가상환경) python3 manage.py runserver 0.0.0.0:8000
