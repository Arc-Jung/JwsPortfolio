클라우드 아키텍처 문서
===========================================================================================
1. 클라우드 컴퓨팅의 정의
------------------------------------------------------------------------------------------
- 전체 프로젝트를 진행할때 배포의 중요성은 매우 높다. localhost에서 완성도가 높은 프로젝트를 만든다고 하여도 프로젝트가 배포 과정이 없다면 다른 사람들이 프로젝트를 외부에서 접근 할 수 없을 것이고 이것은 곧 출시되지 않는 것과 걑은 것이다. 이 문서를 통하여 실제 클라우드에서 이루어지는 개발과 운영 및 배포 과정에 대해서 설명을 할 예정이다. 프로젝트의 목적 및 개요부터 클라우드 컴퓨팅를 최대한으로 사용할 예정으로 프로젝트를 설계해왔다. 그러므로 프로젝트의 AWS를 통한 배포는 꼭 해야한다고 생각하였고 실제로 모든 것을 클라우드에서 구현하였으며 개발을 완료하였다.

- 미국 국립표준기술연구(이하 NIST)의 정의에 따르면 클라우드 컴퓨팅은 '컴퓨터, 네트워크, 서버, 스토리지 , 애플리케이션, 서비스 등 구성 가능한 컴퓨팅 리소르의 공유 풀에 대해 편리하고 언제든지 엑세스 할 수 있으며, 최소한의 관리 노력 또는 서비스 제공업체간의 상호 작동에 의해 신속하게 이용 할 수 있는 모델이다.' 라고 정의 하였다. NIST의 정의는 클라우드 컴퓨팅에 있어서 가장 중요하고 표준적인 정의가 되었다. 또한 구글의 전 CEO 였던 에릭 슈미츠는 클라우드에 대해서 아래와 같이 말하였다.
  
>데이터와 프로그램 모두 다 클라우드 속에 있으면 된다. 필요한 것은 브라우저와 인터넷에 대한 억세스 뿐이다. PC, 맥, 스마트폰 지금 손에 들고 있는 어떠한 단말기로도 접속하여 사용 할 수 있으며 모든 데이터와 데이터 처리는 클라우드 내부의 서버에서 처리한다. - Eric Emerson Schmidt

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/AWS%20GCP%20Azure%20Infographic.jpg">

- 2019년 현재 클라우드 컴퓨팅은 3개의 IT 공룡기업들의 점유율이 압도적이며 전세계 전체 점유율 50%의 아마존 웹 서비스와 기술력 기반의 전통의 강자 마이크로소프트의 Azure 그리고 알파고와 텐서플로우 등의 높은 인공지능 기술을 바탕으로 만든 구글의 Google Cloud Platform(이하 GCP)이 있다. 3가지 기업 중 마이크로 소프트가 시가 총액 1400조원에(2019년 12월 기준) 달하며 구굴의 지주회사인 알파벳의 시가총액 또한 약 1200조원에(2019년 12월 기준) 달하며 가장 적은 수치의 아마존도 약 500조원으로 국내의 가장 큰 기업인 삼성의 모든 계열사를 합친것 보다 최소 2배 이상 많다. 이러한 거대한 IT 공룡기업들은 공통적으로 자체 클라우드 컴퓨팅 솔루션을 가지고 있으며 앞으로의 IT 서비스의 대부분은 클라우드에서 설계 및 개발 그리고 배포 될 것이다. 향후 국내 및 국외 모두 클라우드 컴퓨팅 환경이 대세가 될 것을 확신하며 글을 쓰는 2019년 12월 기준으로 이미 진행되고 있다. 그러므로 백석마켓은 설계 단계부터 기존의 온프라이미스 방식의 서버를 지양하고 클라우드 컴퓨팅을 통해서 100% 클라우드 서비스를 통하여 서비스 할 것을 철저히 설계하여 개발이 진행되었다.

2. 아마존 웹 서비스(이하 AWS) 선정 이유
------------------------------------------------------------------------------------------
- 아마존 웹 서비스(이하 AWS)의 선정이유는 다음과 같다.

        1. 가장 높은 글로벌 및 국내 점유율을 가지고 있다. 이 장점은 AWS를 이용함으로써 개발자에게 가장 넓은 인더스트리 풀을 제공해주는 것으로 프로젝트에 필요한 인력 공급에 있어 유연하게 대처 하도록 하였고 개발 도중 생기는 이슈사항에 대해서도 대처 가능하도록 안정성을 위하여 AWS를 선택하는 중요한 이유가 되었다.

        2. 국내에서 번역된 자료를 찾기 가장 쉽다. 첫번째 이유와 동일한 선상의 이야기지만 국내 개발자들의 클라우드 서비스 이용률은 AWS의 경험이 많으며 이는 곧 번역된 문서를 찾기 쉬워 학습 시간의 단축을 하고 개발시간을 단축 하였다.

        3. AWS 프리티어가 있다. AWS는 가입 후 1년동안 프리티어를 제공해준다. AWS 프리티어는 1년간 1개의 EC2 인스턴스와 1개의 RDS 인스턴스를 무료로 제공해준다. 이는 곧 프로젝트의 비용을 절감 할 수 있는 방법이라고 생각하여 선택하였다.

        4. 타플랫폼 대비 학습의 상승곡선이 가파르다. AWS의 메뉴얼은 대부분 번역되어 있으며 무료 이용자여도 업무시간 내에서라면 무료로 기술지원이 가능하다는 장점을 가지고 있어 선택하였다.

        5. 마지막으로 AWS에 AWS 클라우드9이 있기 때문이다. 개발자라면 누구나 개발환경세팅을 해본 적이 있을 것이다. 하지만 개발환경세팅은 쉬운 일이 아니다. 프로젝트 참여인원의 각각의 컴퓨터에서는 저마다 다른 운영체제와 API 버전, 다른 언어 버전 등 개발환경세팅을 방해할 요소가 굉장히 많다. 하지만 AWS의 클라우드9을 사용하면 인터넷이 사용가능한 모든 PC / Mac / Ubuntu / Android / iPad 등 운영체제와 하드웨어에 의존성 없이 개발에 참여하고 빌드 할 수 있으며 다른 사람이 편집하는 것 또한 실시간으로 볼 수 있는 진정한 의미의 클라우드 통합개발환경을 구성할 수 있으므로 AWS를 선택하는 가장 큰 이유가 되었다.

3. AWS 사용 기술 리스트
------------------------------------------------------------------------------------------
    
    AWS RDS t2.micro With Oracle 12c Enterprise Edition -> 2020년 중 t3.micro로 유지보수 계획.
    AWS EC2 t2.micro -> 2020년 중 t3.micro로 유지보수 계획.
    AWS S3 Bucket
    AWS CloudWatch
    AWS Cloud9
    AWS EBS
    AWS S3
    AWS LoadBalance
    AWS IAM


4. AWS EC2
------------------------------------------------------------------------------------------

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20EC2_1.png">

- Amazon EC2는 Amazon Elastic Compute Cloud의 약자로 클라우드에서 확장식 컴퓨팅(오토스케일링)을 제공한다. 클라우드 컴퓨팅 이전의 온프레미스(On-premise) 방식은 IDC 또는 직장 내의 특정한 공간에 서버렉을 설치하여 그곳에 서버 장비들을 설치하는 방식이였다. 이 방식은 서버를 위한 인원을 배치해야 하고 서버에 필요한 하드웨어와 소프트웨어의 설치와 라우터 설정 등 수많은 절차가 있었고 기간은 짧게는 몇주에서 길게는 몇달에 이르기까지 수많은 시간과 비용과 인력이 소모되었다. 초기 투자 비용이 없는 소규모 프로젝트팀 또는 업체들은 이 비용이 큰 부담으로 다가왔고 서버 구성에 소극적으로 변하였다. 하지만 클라우드의 등장으로 소규모 프로젝트에서는 이러한 온프레미스 방식은 비선호 되었고, 클라우드를 다룰 수 있는 사람 1명만 있으면 간편하고 편리하게 서버를 구성할 수 있게 되었고 그 결과 폭발적인 스타트업 업체들이 생기게 되었다. 백석마켓또한 localhost에서 나와 클라우드를 통하여 실제 배포단계까지 구현할 수 있게 되었다.

- Amazon EC2의 자세한 성능 및 세팅은 다음과 같다.
        인스턴스 유형 : t2.micro
        시작 시간 : 2019년 11월 10일 오후 6시 42분 26초
        IPv4 퍼블릭 IP : 18.189.29.144
        vCPU : 1
        메모리 : 1GB
  
1. AWS RDS
------------------------------------------------------------------------------------------

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20RDS%20Logo.png">

- Amazon RDS는 Amazon Relational Database Service의 약자로 CPU, 메모리, 스토리지 및 IOPS가 모두 한데 묶여 하나의 서비스로 구성하여 제공한다. RDS를 구성하게 되면 데이터 베이스를 단 몇분만에 구성이 가능하다. Amazon RDS는 백업, 소프트웨어 패치, 자동 장애 감지 및 복구를 관리하며 사용자의 설정에 따라 RDS의 로그를 AWS의 범용 스토리지인 S3에 저장을 할 수 있다.

- 백석마켓에서는 t3.micro 인스턴스를 사용하며 2vCPU를 가져 상대적으로 여유로운 성능을 가지고 있다. DBMS는 Oracle Oracle 12c Enterprise Edition을 사용하고 있다. 매일 오전 9시에 백업을 하여서 7일간 인스턴스 자체와 모든 설정 및 데이터를 자동으로 백업하는 시스템을 가지고 있어 안정성을 높였다. 또한 백석 마켓의 데이터베이스 로그는 매일 저녁 8시경 S3 스토리지에 모든 데이터를 보관하며 약 180일 가량을 저장하고 이후엔 삭제가 되도록 하였다. 이러한 강력한 하드웨어와 소프트웨어를 가진 데이터베이스를 시간당 50원에 이용 할 수 있다.

6. AWS EBS
------------------------------------------------------------------------------------------

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20EBS%20Logo.png">

- AWS EBS는 Amazon Elastic Block Store의 약자로 대규모로 처리량과 트랜잭션 집약적인 워크로드 모두를 지원하기 위해 EC2에서 사용하도록 설계된 사용하기 쉬운 고성능 블록 스토리지 서비스이다. AWS EC2의 프로세스와 SSD는 물리적으로 분리되어 있으며 t3.micro 인스턴스를 사용하다가 CPU의 부하량이 일정 수준 이상 넘을 경우 개발자는 EBS 스토리지의 스냅샷을 저장한 후 EC2 인스턴스의 프로세스를 다른 프로세스로 변경이 가능하다. 즉 1vCPU 1GB의 t3.micro에서 m5d.24xlarge의 96개의 vCPU와 384GB의 엉청난 성능의 인스턴스로 쉽게 수직 확장 할 수 있다.

1. AWS Loadbalace
------------------------------------------------------------------------------------------

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20LoadBalance%203.png">
<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20LoadBalance%202.png">
<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20LoadBalance%204.png">

- AWS 로드 밸런서란 클라우드의 특징 기능 중 하나이다. 기존의 온프라이미스 서버에서는 하나의 서버 패키지에는 최대 96개의 CPU와 192개의 스레드만 지원한다. 하지만 클라우드에서는 프로세스를 무한히 확장가능하다. 바로 AWS 로드 밸런서이다. 로드 밸런서를 이용하여 어플리케이션의 수요 변동에 따라 인프라가 빠르게 확장 하거나 축소 할 수 있도록 만들 수 있다. AWS 로드 밸런서를 사용 할때의 주의점으로는 GCP HTTP 로드 밸런스 보다 인스턴스의 생성시간에 몇 분이 걸림으로 로드 밸런서의 Health Check를 상대적으로 여유롭게 설정하는 편이 어플리케이션의 장애 예방에 효과적이다.

8. AWS S3 Bucket
------------------------------------------------------------------------------------------
- AWS S3

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20EBS%20Logo.png">

- 데이터베이스 내부에 직접 이미지를 저장하는 방식은 데이터베이스의 처리량, 네트워크, 디스크 모든 자원에 대해서 부담을 가하며 비효율적인 방법이다. 기존의 온프라이미스 서버에서는 웹서버에서 별도의 포트를 열어두어 파일의 입출력을 할당하는데 이러한 방식은 온프라이미스 서버에서는 상당한 부하를 가하는 방식이고 이는 곧 웹서버의 과부하 또는 파일 입출력 전용 웹서버를 구축하여 해결하였다. 하지만 클라우드 컴퓨팅 시대에 AWS S3와 GCP Storage는 이러한 단점을 완전히 해결하기 위해 별도의 서비스를 생성하여 서버와 데이터베이스에 부하를 줄이는 방식을 사용하고 있다. 백석마켓은 저장된 이미지의 주소값만 저장하도록 하였다. 이러한 방식을 통하여 대용량의 파일을 입출력하여도 웹서버 / WAS / 데이터베이스는 항상 일정한 퍼포먼스를 유지 할 수 있도록 초기 설계에서부터 계획하여 구현하였다.

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20S3%20Log%20Bucket.png">

- AWS S3를 통하여 로그를 저장하는 기능으로 사용 할 수 있도록 하였다. 2020년 1월에 추가한 기능으로 나의 Github 포트폴리오 페이지와 백석마켓에 HTTP 메소드를 내역을 모두 수집하여 자동으로 S3에 저장하도록 하였다. 무한히 그리고 영구히 저장하는 S3를 이용하여 서버내 발생되는 모든 로그를 저장하도록 하였다.

9. AWS CloudWatch
------------------------------------------------------------------------------------------

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/AWS%20CloudWatch.png">

 - CloudWatch는 AWS 에서 발생하는 모든 리소스와 실시간으로 실행 중인 모든 애플리케이션을 모니터링할 수 있다. CPU 및 네트워크 사용량을 항상 체크하며 필요시 메일으로 알려주어 개발한 어플리케이션의 운영 성능 및 리소스 최적화를 개선할 때 사용하기에 유용한 기능이다. 
 -  Google Cloud Platform 보다 EC2 생성에 분단위의 시간이 소요되는 만큼 CloudWatch의 Health Check를 조금 더 신경쓰면서 로드율에 따라 로드밸런서의 설정을 여유롭게 해야한다. 이번 프로젝트의 경우 EC2 T2.micro의 CPU 사용량이 60%를 넘어갈 경우 자동으로 스케일업을 하도록 설정하였다. 
 - CloudWatch의 대쉬보드를 통하여 실제 어플리케이션을 운영하면서 생기는 다양한 데이터를 수집하여 문제를 해결하거나 모니터링에 사용 할 수 있도록 설정하였다.

1.  AWS Cloud 9
------------------------------------------------------------------------------------------

<img src="https://bumarket.s3.ap-northeast-2.amazonaws.com/BuMarket+AWS+Cloud9.png">

- AWS Cloud9은 AWS EC2 인스턴스에서 구동되는 클라우드 IDE로 Cloud 9에서 개발 및 배포 서버운영까지 모든 것을 한번에 해결할 수 있었다. 특히 프로젝트를 진행하다보면 소스 파일을 받아 자신의 컴퓨터에 맞게 개발환경을 변경하거나 하는 경우가 일어나는데 Cloud 9은 인터넷이 접속이 되는 어떠한 수단으로도 접속하여 서버의 로그를 확인하거나 코딩을 수정하거나 코드를 보는 것이 가능하였다. 개발, 배포, 테스트 까지 한곳에서 해결함에 따라 생산성을 높일 수 있었다.
- Cloud9 is a cloud IDE running on AWS EC2 instances. Cloud 9 can run development and deployment servers. Cloud9 is productive when together.

11. AWS IAM
------------------------------------------------------------------------------------------

<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20IAM%20Intro.png">
<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/BuMarket%20AWS%20IAM.png">

-  [ 프로젝트 읽기 전용 계정 로그인 링크 ](https://427427425172.signin.aws.amazon.com/console)
-  [ 프로젝트 읽기 전용 계정 신청 링크  ](https://forms.gle/eGroUMptkAhSfEqL9)

- 처음 클라우드를 사용한다면 대부분 AWS 루트 계정을 통하여 접속하여 작업을 하는 경우가 많다. 하지만 이러한 방식은 다수의 유저가 하나의 프로젝트를 제작할 경우 커다란 문제를 일으킬 수 있다. 이러한 문제를 해결하기 위해서 AWS Identity and Access Management(이하 IAM)를 활용 하도록 아마존 웹 서비스는 권장하고 있다.  IAM을 사용하면 AWS 리소스에 대한 세분화된 액세스 제어가 가능하며 권한이 높은 루트 유저와 백엔드와 프론트엔드를 개발하는 Read / Write 유저, 그리고 각 기업의 보안이나 회계 관리를 위한 Read만 가능한 뷰 유저 등 다양한 역활을 지정할 수 있다. 가끔 메일로 실제 이 프로젝트의 AWS의 환경구성에 관심이 있으신 분들이 있어 S3 / Cloud 9 / CloudWatch의 읽기 권한의 계정을 제공하여 보여준적이 있다. 만약 이 글을 읽다가 실제 구현환경을 직접 보고 싶다면 메일을 보내면 된다. (메일 주소 : dag890789@gmail.com)  
  
1.  Scalable RESTful Server Architecture
------------------------------------------------------------------------------------------
<img src="https://raw.githubusercontent.com/dsg890789/JwsPortfolio/master/Django%20Framework%20Project/Scalable%20RESTful%20Server%20Architecture.png">

- 백석마켓은 철저한 사전 조사를 통하여 설계를 진행하였다. 지금까지 설명한 모든 기술들을 사용하여 백석마켓 프로젝트의 전체 설계도를 그렸다. 기존에 활용하였던 AWS의 많은 기능들을 하나의 프로젝트를 통하여 구현하고 싶었고 이 과정은 수많은 개발자들과 기술이사님 , 교수님들과 수많은 질문을 던지며 개발하였다.  8가지의 과정을 통하여 백석마켓은 개발이 진행되었다.

 1. 사용자가 안드로이드에서 HTTP 프토토콜을 이용하여 http://18.189.29.144:8000/ 의 주소에 8000번 포트를 통하여 Request를 보낸다. 
 2. 파이썬 가상환경에서 Django Framework를 실행된 AWS EC2가 8000번 포트로 들어온 통신을 받는다.
 3. RESTful API 통해 Request의 Header, Body를 Django Framework가 해석하여 Response로 보낸다.
 4. 이 과정에서 AWS EC2의 CPU 사용량이 60%를 초과한다면 AWS Loadbalace를 통하여 Aouto Scailing이 작동하여 T2.micro 인스턴스를 추가로 생성한다. 최대 4대까지의 T2.micro 인스턴스가 수평 확장된다.
 5. 안드로이드 클라이언트에서 보낸 Request가 데이터베이스의 정보를 조회하는 요청일 경우 AWS EC2는 AWS RDS의 IP 주소의 1521번 포트에 접속하여 Django Framework ORM을 이용하여 데이터베이스를 조회하는 쿼리를 생성하여 실행하여 Response에 담아 안드로이드 클라이언트에게 답한다.
 6. AWS EC2와 AWS RDS에서 생성된 모든 로그는 AWS S3의 awsserverlog 스토리지에 모두 저장한다.
 7. 발생된 로그를 AWS CloudWatch 대시보드에서 모든 로그를 실시간으로 모니터링한다.
 8. 클라우드에서 허용된 권한을 가진 인원이 IAM 계정을 부여받아 Cloud 9 에서 개발을 진행하도록 한다.